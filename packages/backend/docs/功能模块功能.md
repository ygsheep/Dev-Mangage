# 功能模块功能

## 概述

功能模块功能是DevAPI Manager中的业务逻辑组织工具，用于将项目中的API按照业务功能进行分组和管理。它提供了一个结构化的方式来组织和展示项目的各个功能模块，帮助开发团队更好地理解和管理复杂的API系统。

## 功能特性

### 1. 模块化管理
- **业务分组**：将相关的API按业务功能分组
- **CRUD模式**：自动识别和生成标准的增删改查操作
- **层次结构**：支持模块的层次化组织
- **统计信息**：提供模块内API的统计和状态分析

### 2. 自动化功能
- **智能分组**：基于API路径和命名自动分组
- **模块推断**：根据现有API推断可能的业务模块
- **完整性检查**：检查模块内CRUD操作的完整性
- **依赖分析**：分析模块间的依赖关系

### 3. 可视化展示
- **卡片视图**：以卡片形式展示功能模块
- **进度指示**：显示模块开发进度和API状态
- **快速操作**：提供快速创建、编辑、测试功能
- **状态标识**：清晰的状态颜色标识

## 技术实现

### 前端架构

#### 核心组件结构

```
ProjectDetailPage
├── FeatureModuleCard       # 功能模块卡片组件
├── ModuleAPIList          # 模块内API列表
├── ModuleProgressBar      # 模块进度条
└── ModuleActionMenu       # 模块操作菜单
```

#### 数据模型

```typescript
interface FeatureModule {
  id: string
  name: string
  description: string
  category: string
  apis: API[]
  completionRate: number
  status: ModuleStatus
  createdAt: string
  updatedAt: string
}

enum ModuleStatus {
  NOT_STARTED = 'NOT_STARTED',
  IN_PROGRESS = 'IN_PROGRESS', 
  COMPLETED = 'COMPLETED',
  NEEDS_REVIEW = 'NEEDS_REVIEW'
}
```

### 模块生成算法

#### 1. API分组逻辑

```typescript
const generateFeatureModules = (apis: API[]) => {
  // 按路径前缀分组
  const pathGroups = groupAPIsByPathPrefix(apis)
  
  // 生成CRUD API集合
  const modules = pathGroups.map(group => {
    const crudAPIs = generateCRUDAPIs(group.name, group.basePath)
    const existingAPIs = group.apis
    
    return {
      id: generateModuleId(group.name),
      name: group.name,
      description: generateModuleDescription(group.name),
      apis: mergeAPIs(existingAPIs, crudAPIs),
      completionRate: calculateCompletionRate(existingAPIs, crudAPIs)
    }
  })
  
  return modules
}
```

#### 2. CRUD API模式

每个功能模块默认包含以下API模式：

```typescript
const CRUD_PATTERNS = {
  LIST: { method: 'GET', path: '' },
  CREATE: { method: 'POST', path: '' },
  DETAIL: { method: 'GET', path: '/:id' },
  UPDATE: { method: 'PUT', path: '/:id' },
  DELETE: { method: 'DELETE', path: '/:id' }
}
```

#### 3. 进度计算

```typescript
const calculateCompletionRate = (existing: API[], expected: API[]) => {
  const completedAPIs = existing.filter(api => 
    api.status === APIStatus.COMPLETED || api.status === APIStatus.TESTED
  )
  return (completedAPIs.length / expected.length) * 100
}
```

### 内置功能模块

系统预定义了常见的功能模块模板：

#### 1. 用户管理模块
```typescript
{
  name: '用户管理',
  basePath: '/api/v1/users',
  description: '用户注册、登录、信息管理',
  apis: [
    { name: '用户列表', method: 'GET', path: '/users' },
    { name: '创建用户', method: 'POST', path: '/users' },
    { name: '用户详情', method: 'GET', path: '/users/:id' },
    { name: '更新用户', method: 'PUT', path: '/users/:id' },
    { name: '删除用户', method: 'DELETE', path: '/users/:id' },
    { name: '用户登录', method: 'POST', path: '/auth/login' },
    { name: '用户注册', method: 'POST', path: '/auth/register' }
  ]
}
```

#### 2. 权限管理模块
```typescript
{
  name: '权限管理',
  basePath: '/api/v1/permissions',
  description: '角色权限控制和访问管理',
  apis: [
    { name: '权限列表', method: 'GET', path: '/permissions' },
    { name: '分配权限', method: 'POST', path: '/permissions/assign' },
    { name: '角色管理', method: 'GET', path: '/roles' },
    { name: '检查权限', method: 'POST', path: '/permissions/check' }
  ]
}
```

#### 3. 内容管理模块
```typescript
{
  name: '内容管理',
  basePath: '/api/v1/content',
  description: '文章、媒体文件等内容的管理',
  apis: [
    { name: '文章列表', method: 'GET', path: '/articles' },
    { name: '发布文章', method: 'POST', path: '/articles' },
    { name: '文章详情', method: 'GET', path: '/articles/:id' },
    { name: '编辑文章', method: 'PUT', path: '/articles/:id' },
    { name: '删除文章', method: 'DELETE', path: '/articles/:id' },
    { name: '文件上传', method: 'POST', path: '/upload' }
  ]
}
```

## 界面设计

### 模块卡片布局

```tsx
const FeatureModuleCard = ({ module }: { module: FeatureModule }) => (
  <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
    {/* 模块头部 */}
    <div className="flex items-center justify-between mb-4">
      <div className="flex items-center space-x-3">
        <div className="w-10 h-10 bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
          <Icon className="w-5 h-5 text-white" />
        </div>
        <div>
          <h3 className="text-lg font-semibold text-gray-900">{module.name}</h3>
          <p className="text-sm text-gray-600">{module.description}</p>
        </div>
      </div>
      <ModuleStatusBadge status={module.status} />
    </div>
    
    {/* 进度条 */}
    <ModuleProgressBar 
      completed={module.completedAPIs} 
      total={module.totalAPIs}
      completionRate={module.completionRate}
    />
    
    {/* API列表 */}
    <div className="mt-4 space-y-2">
      {module.apis.slice(0, 3).map(api => (
        <APIItem key={api.id} api={api} />
      ))}
      {module.apis.length > 3 && (
        <div className="text-sm text-gray-500 text-center">
          还有 {module.apis.length - 3} 个API...
        </div>
      )}
    </div>
    
    {/* 操作按钮 */}
    <div className="flex space-x-2 mt-4">
      <button className="btn-primary">查看详情</button>
      <button className="btn-secondary">快速测试</button>
    </div>
  </div>
)
```

### 状态颜色方案

```css
.module-status-not-started { @apply bg-gray-100 text-gray-800; }
.module-status-in-progress { @apply bg-blue-100 text-blue-800; }
.module-status-completed { @apply bg-green-100 text-green-800; }
.module-status-needs-review { @apply bg-yellow-100 text-yellow-800; }
```

## 交互功能

### 1. 模块管理操作

- **查看详情**：展开显示模块内所有API
- **快速创建**：根据模板快速创建缺失的API
- **批量测试**：对模块内所有API进行批量测试
- **导出文档**：生成模块的API文档

### 2. API状态管理

- **状态更新**：快速更新API的开发状态
- **进度跟踪**：实时显示模块开发进度
- **问题标记**：标记有问题的API

### 3. 协作功能

- **任务分配**：将模块分配给团队成员
- **评审流程**：模块完成后的代码评审
- **变更追踪**：记录模块的变更历史

## 扩展机制

### 1. 自定义模块模板

```typescript
interface ModuleTemplate {
  name: string
  category: string
  description: string
  apiPatterns: APIPattern[]
  validationRules: ValidationRule[]
}

const customTemplate: ModuleTemplate = {
  name: '支付模块',
  category: '业务核心',
  description: '支付相关的API集合',
  apiPatterns: [
    { name: '创建订单', method: 'POST', path: '/orders' },
    { name: '支付接口', method: 'POST', path: '/payments' },
    { name: '查询支付状态', method: 'GET', path: '/payments/:id/status' }
  ],
  validationRules: [
    { field: 'amount', type: 'number', required: true },
    { field: 'currency', type: 'string', enum: ['CNY', 'USD'] }
  ]
}
```

### 2. 插件机制

```typescript
interface ModulePlugin {
  name: string
  version: string
  hooks: {
    beforeCreate?: (module: FeatureModule) => FeatureModule
    afterCreate?: (module: FeatureModule) => void
    beforeUpdate?: (module: FeatureModule) => FeatureModule
    afterUpdate?: (module: FeatureModule) => void
  }
}
```

## 集成能力

### 与其他功能的集成

1. **API管理集成**：与API CRUD操作无缝集成
2. **测试集成**：集成API测试功能
3. **文档集成**：自动生成模块文档
4. **监控集成**：API性能和错误监控
5. **版本控制**：模块版本管理

### 数据同步

```typescript
const syncModuleWithAPIs = async (projectId: string) => {
  const apis = await apiMethods.getAPIs({ projectId })
  const modules = generateFeatureModules(apis)
  
  // 更新模块状态
  modules.forEach(module => {
    updateModuleProgress(module.id, module.completionRate)
  })
}
```

## 最佳实践

### 1. 模块划分原则

- **业务相关性**：相关业务逻辑放在同一模块
- **职责单一**：每个模块有明确的职责边界
- **独立性**：模块间保持相对独立，减少耦合
- **完整性**：模块内包含完整的CRUD操作

### 2. 命名规范

- **模块名称**：使用业务术语，简洁明了
- **API命名**：遵循RESTful规范
- **路径设计**：保持一致的路径结构

### 3. 状态管理

- **及时更新**：API状态变更时及时更新模块状态
- **进度跟踪**：定期检查模块开发进度
- **质量把控**：确保API质量符合标准

## 未来规划

### 短期目标

1. **模块模板库**：构建丰富的行业模块模板
2. **智能推荐**：根据项目类型推荐合适的模块
3. **依赖分析**：分析和可视化模块间依赖
4. **性能优化**：优化大项目的模块加载性能

### 长期愿景

1. **AI辅助设计**：AI辅助模块结构设计
2. **代码生成**：根据模块自动生成代码骨架
3. **微服务拆分**：辅助微服务架构拆分决策
4. **团队协作**：增强团队协作和任务管理功能

功能模块功能作为DevAPI Manager的重要组成部分，为项目的业务逻辑组织提供了有力支持，有助于提升开发团队的协作效率和代码质量。